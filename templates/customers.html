<!-- ./templates/customers.html -->
{% extends "base.html" %}

{% block content %}
    <h1>Customer Management</h1>

    <h2>Add Customer</h2>
    <form id="customerForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        
        <label for="email">Email:</label>
        <input type="email" id="email" name="email">
        
        <label for="phone">Phone:</label>
        <input type="tel" id="phone" name="phone">
        
        <button type="submit">Add Customer</button>
    </form>

    <h2>Customer List</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Contact</th>
                <th>Balance</th>
                <th>Last Reminder</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
            <tr>
                <td>{{ customer.id }}</td>
                <td>{{ customer.name }}</td>
                <td>
                    {% if customer.email %}{{ customer.email }}<br>{% endif %}
                    {% if customer.phone %}{{ customer.phone }}{% endif %}
                </td>
                <td>${{ "%.2f"|format(customer.balance) }}</td>
                <td>{{ customer.last_reminder or 'Never' }}</td>
                <td>
                    {% if customer.balance > 0 %}
                    <button onclick="sendReminder({{ customer.id }})">Send Reminder</button>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function sendReminder(customerId) {
            fetch(`/customers/${customerId}/send-reminder`, {
                method: 'POST'
            }).then(response => {
                if (response.ok) {
                    alert('Reminder sent successfully!');
                    window.location.reload();
                } else {
                    alert('Failed to send reminder');
                }
            });
        }
    </script>
{% endblock %}