.
├── app
│   ├── crud.py
│   ├── database.py
│   ├── main.py
│   ├── models.py
│   └── schemas.py
├── __init__.py
├── inventory.db
├── learn.md
├── output.txt
├── README.md
├── specifications.txt
├── static
│   ├── css
│   │   └── style.css
│   └── js
│       └── main.js
└── templates
    ├── base.html
    ├── customers.html
    ├── edit_product.html
    ├── index.html
    ├── invoices.html
    ├── products.html
    ├── restocks.html
    ├── sales.html
    └── sales_report.html

7 directories, 29 files

## ./__init__.py
from app.database import Base, engine
from app.models import Product, Sale, Restock, Invoice

# Drop all tables and recreate them
Base.metadata.drop_all(bind=engine)
Base.metadata.create_all(bind=engine)
## ./README.md
# inventory_kashur_kulture
## ./app/schemas.py
from pydantic import BaseModel
from typing import Optional
from datetime import datetime
class ProductBase(BaseModel):
    name: str
    description: Optional[str] = None
    price: float
    quantity: int

class ProductCreate(ProductBase):
    pass

class Product(ProductBase):
    id: int

    class Config:
        from_attributes = True

class SaleBase(BaseModel):
    product_id: int
    quantity: int

class SaleCreate(SaleBase):
    pass

class Sale(SaleBase):
    id: int
    sale_date: datetime

    class Config:
        from_attributes = True

class RestockBase(BaseModel):
    product_id: int
    quantity: int

class RestockCreate(RestockBase):
    pass

class Restock(RestockBase):
    id: int
    restock_date: datetime

    class Config:
        from_attributes = True

class InvoiceBase(BaseModel):
    sale_id: int

class InvoiceCreate(InvoiceBase):
    pass

class Invoice(InvoiceBase):
    id: int
    invoice_date: datetime

    class Config:
        from_attributes = True


class ProductUpdate(BaseModel):
    name: Optional[str] = None
    description: Optional[str] = None
    price: Optional[float] = None
    quantity: Optional[int] = None
## ./app/main.py
from fastapi import FastAPI, Depends, HTTPException, Request
from fastapi.responses import HTMLResponse
from fastapi.templating import Jinja2Templates
from fastapi.staticfiles import StaticFiles
from sqlalchemy.orm import Session
from . import crud, schemas, models, database

app = FastAPI()

# Mount static files
app.mount("/static", StaticFiles(directory="static"), name="static")

# Initialize templates
templates = Jinja2Templates(directory="templates")

# Dependency to get the database session
def get_db():
    db = database.SessionLocal()
    try:
        yield db
    finally:
        db.close()

# Root Endpoint
@app.get("/", response_class=HTMLResponse)
def read_root(request: Request):
    return templates.TemplateResponse("index.html", {"request": request})

# Product Endpoints
@app.get("/products", response_class=HTMLResponse)
def read_products(request: Request, db: Session = Depends(get_db)):
    products = crud.get_all_products(db)
    return templates.TemplateResponse("products.html", {"request": request, "products": products})

@app.post("/products/", response_model=schemas.Product)
def create_product(product: schemas.ProductCreate, db: Session = Depends(get_db)):
    return crud.create_product(db, product)

@app.post("/products/", response_model=schemas.Product)
def create_product(product: schemas.ProductCreate, db: Session = Depends(get_db)):
    return crud.create_product(db, product)

# Sale Endpoints
@app.get("/sales", response_class=HTMLResponse)
def read_sales(request: Request, db: Session = Depends(get_db)):
    sales = crud.get_all_sales(db)
    return templates.TemplateResponse("sales.html", {"request": request, "sales": sales})

@app.post("/sales/", response_model=schemas.Sale)
def create_sale(sale: schemas.SaleCreate, db: Session = Depends(get_db)):
    return crud.create_sale(db, sale)

# Restock Endpoints
@app.get("/restocks", response_class=HTMLResponse)
def read_restocks(request: Request, db: Session = Depends(get_db)):
    restocks = crud.get_all_restocks(db)
    return templates.TemplateResponse("restocks.html", {"request": request, "restocks": restocks})

@app.post("/restocks/", response_model=schemas.Restock)
def create_restock(restock: schemas.RestockCreate, db: Session = Depends(get_db)):
    return crud.create_restock(db, restock)

# Invoice Endpoints
@app.get("/invoices", response_class=HTMLResponse)
def read_invoices(request: Request, db: Session = Depends(get_db)):
    invoices = crud.get_all_invoices(db)
    return templates.TemplateResponse("invoices.html", {"request": request, "invoices": invoices})

@app.post("/invoices/", response_model=schemas.Invoice)
def create_invoice(invoice: schemas.InvoiceCreate, db: Session = Depends(get_db)):
    return crud.create_invoice(db, invoice)


@app.get("/products/{product_id}/edit", response_class=HTMLResponse)
def edit_product(request: Request, product_id: int, db: Session = Depends(get_db)):
    product = crud.get_product(db, product_id)
    if product is None:
        raise HTTPException(status_code=404, detail="Product not found")
    return templates.TemplateResponse("edit_product.html", {"request": request, "product": product})

@app.put("/products/{product_id}", response_model=schemas.Product)
def update_product(product_id: int, product: schemas.ProductUpdate, db: Session = Depends(get_db)):
    db_product = crud.update_product(db, product_id, product)
    if db_product is None:
        raise HTTPException(status_code=404, detail="Product not found")
    return db_product

# main.py
@app.delete("/products/{product_id}", response_model=schemas.Product)
def delete_product(product_id: int, db: Session = Depends(get_db)):
    if not crud.delete_product(db, product_id):
        raise HTTPException(status_code=404, detail="Product not found")
    return {"message": "Product deleted successfully"}

# main.py
@app.get("/sales-report", response_class=HTMLResponse)
def read_sales_report(request: Request, db: Session = Depends(get_db)):
    sales_report = crud.get_sales_report(db)
    return templates.TemplateResponse("sales_report.html", {"request": request, "sales_report": sales_report})

# main.py
@app.get("/products/search", response_class=HTMLResponse)
def search_products(request: Request, query: str, db: Session = Depends(get_db)):
    products = crud.search_products(db, query)
    return templates.TemplateResponse("products.html", {"request": request, "products": products})
## ./app/__pycache__/crud.cpython-312.pyc

## ./app/database.py
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker

SQLALCHEMY_DATABASE_URL = "sqlite:///./inventory.db"

engine = create_engine(
    SQLALCHEMY_DATABASE_URL, connect_args={"check_same_thread": False}
)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

Base = declarative_base()
## ./app/models.py
from sqlalchemy import Column, Integer, String, Float, DateTime, ForeignKey
from sqlalchemy.sql import func
from .database import Base

# Product model
class Product(Base):
    __tablename__ = "products"  # Table name
    id = Column(Integer, primary_key=True, index=True)  # Primary key
    name = Column(String, index=True)  # Product name
    description = Column(String, nullable=True)  # Product description (optional)
    price = Column(Float)  # Product price
    quantity = Column(Integer)  # Product quantity

# Sale model
class Sale(Base):
    __tablename__ = "sales"  # Table name
    id = Column(Integer, primary_key=True, index=True)  # Primary key
    product_id = Column(Integer, ForeignKey("products.id"))  # Foreign key to products
    quantity = Column(Integer)  # Quantity sold
    sale_date = Column(DateTime, default=func.now())  # Sale date (auto-generated)

# Restock model
class Restock(Base):
    __tablename__ = "restocks"  # Table name
    id = Column(Integer, primary_key=True, index=True)  # Primary key
    product_id = Column(Integer, ForeignKey("products.id"))  # Foreign key to products
    quantity = Column(Integer)  # Quantity restocked
    restock_date = Column(DateTime, default=func.now())  # Restock date (auto-generated)

# Invoice model
class Invoice(Base):
    __tablename__ = "invoices"  # Table name
    id = Column(Integer, primary_key=True, index=True)  # Primary key
    sale_id = Column(Integer, ForeignKey("sales.id"))  # Foreign key to sales
    invoice_date = Column(DateTime, default=func.now())  # Invoice date (auto-generated)
## ./app/crud.py
from sqlalchemy.orm import Session
from . import models, schemas

# Product CRUD
def create_product(db: Session, product: schemas.ProductCreate):
    db_product = models.Product(**product.dict())
    db.add(db_product)
    db.commit()
    db.refresh(db_product)
    print(db_product.__dict__)  # Log the created product
    return db_product   

def get_product(db: Session, product_id: int):
    return db.query(models.Product).filter(models.Product.id == product_id).first()

def get_all_products(db: Session):
    return db.query(models.Product).all()

# Sale CRUD
def create_sale(db: Session, sale: schemas.SaleCreate):
    db_sale = models.Sale(**sale.dict())
    db.add(db_sale)
    db.commit()
    db.refresh(db_sale)
    return db_sale

def get_all_sales(db: Session):
    return db.query(models.Sale).all()

# Restock CRUD
def create_restock(db: Session, restock: schemas.RestockCreate):
    db_restock = models.Restock(**restock.dict())
    db.add(db_restock)
    db.commit()
    db.refresh(db_restock)
    print(db_restock.__dict__)  # Log the created restock
    return db_restock

def get_all_restocks(db: Session):
    return db.query(models.Restock).all()

# Invoice CRUD
def create_invoice(db: Session, invoice: schemas.InvoiceCreate):
    db_invoice = models.Invoice(**invoice.dict())
    db.add(db_invoice)
    db.commit()
    db.refresh(db_invoice)
    return db_invoice

def get_all_invoices(db: Session):
    return db.query(models.Invoice).all()


def update_product(db: Session, product_id: int, product: schemas.ProductUpdate):
    db_product = db.query(models.Product).filter(models.Product.id == product_id).first()
    if db_product:
        for key, value in product.dict(exclude_unset=True).items():
            setattr(db_product, key, value)
        db.commit()
        db.refresh(db_product)
    return db_product


# crud.py
def delete_product(db: Session, product_id: int):
    db_product = db.query(models.Product).filter(models.Product.id == product_id).first()
    if db_product:
        db.delete(db_product)
        db.commit()
        return True
    return False


# crud.py
def create_sale(db: Session, sale: schemas.SaleCreate):
    product = db.query(models.Product).filter(models.Product.id == sale.product_id).first()
    if not product:
        raise HTTPException(status_code=404, detail="Product not found")
    if product.quantity < sale.quantity:
        raise HTTPException(status_code=400, detail="Insufficient stock")
    
    product.quantity -= sale.quantity  # Deduct stock
    db_sale = models.Sale(**sale.dict())
    db.add(db_sale)
    db.commit()
    db.refresh(db_sale)
    return db_sale


# crud.py
from sqlalchemy import func

def get_sales_report(db: Session):
    return db.query(
        func.date(models.Sale.sale_date).label("sale_date"),
        func.sum(models.Sale.quantity).label("total_sales"),
        func.sum(models.Sale.quantity * models.Product.price).label("total_revenue")
    ).join(models.Product).group_by(func.date(models.Sale.sale_date)).all()

# crud.py
def search_products(db: Session, query: str):
    return db.query(models.Product).filter(
        (models.Product.name.contains(query)) | (models.Product.description.contains(query))
    ).all()
## ./output.txt

## ./static/css/style.css
/* General Styles */
body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f4;
}

.container {
    width: 80%;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
}

h1 {
    color: #333;
}

/* Form Styles */
form {
    margin-bottom: 20px;
}

label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
}

input[type="text"],
input[type="number"],
select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

button {
    padding: 10px 15px;
    background-color: #28a745;
    color: #fff;
    border: none;
    border-radius: 4px;
    cursor: pointer;
}

button:hover {
    background-color: #218838;
}

/* Table Styles */
table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

th, td {
    padding: 10px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}

th {
    background-color: #f8f9fa;
}

/* Navigation Styles */
.navbar {
    background-color: #333;
    overflow: hidden;
}

.navbar a {
    float: left;
    display: block;
    color: #f2f2f2;
    text-align: center;
    padding: 14px 16px;
    text-decoration: none;
}

.navbar a:hover {
    background-color: #ddd;
    color: black;
}

/* style.css */
/* Add responsive table styles */
@media (max-width: 768px) {
    table, thead, tbody, th, td, tr {
        display: block;
    }
    th {
        position: absolute;
        top: -9999px;
        left: -9999px;
    }
    tr {
        border: 1px solid #ccc;
    }
    td {
        border: none;
        position: relative;
        padding-left: 50%;
    }
    td:before {
        position: absolute;
        left: 6px;
        content: attr(data-label);
        font-weight: bold;
    }
}
## ./static/js/main.js
// Function to handle form submissions
async function submitForm(formId, endpoint, method = "POST") {
    const form = document.getElementById(formId);
    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch(endpoint, {
                method: method,
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                alert("Operation successful!");
                window.location.reload(); // Reload the page to reflect changes
            } else {
                alert("Something went wrong!");
            }
        } catch (error) {
            console.error("Error:", error);
        }
    });
}

// Example: Handle product form submission
document.addEventListener("DOMContentLoaded", () => {
    submitForm("productForm", "/products/");
    submitForm("saleForm", "/sales/");
    submitForm("restockForm", "/restocks/");
    submitForm("invoiceForm", "/invoices/");
});


// Function to handle edit form submission
async function submitEditForm(formId, endpoint, method = "PUT") {
    const form = document.getElementById(formId);
    form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch(endpoint, {
                method: method,
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                alert("Product updated successfully!");
                window.location.href = "/products"; // Redirect to products page
            } else {
                alert("Something went wrong!");
            }
        } catch (error) {
            console.error("Error:", error);
        }
    });
}

// Handle edit product form submission
document.addEventListener("DOMContentLoaded", () => {
    submitEditForm("editProductForm", `/products/${document.getElementById("id").value}`);
});


// main.js
function confirmDelete(productId) {
    if (confirm("Are you sure you want to delete this product?")) {
        fetch(`/products/${productId}`, {
            method: "DELETE",
        }).then(response => {
            if (response.ok) {
                alert("Product deleted successfully!");
                window.location.reload();
            } else {
                alert("Something went wrong!");
            }
        });
    }
}

// main.js
function searchProducts(event) {
    event.preventDefault();
    const query = document.getElementById("searchQuery").value;
    window.location.href = `/products/search?query=${query}`;
}
## ./templates/sales.html
{% extends "base.html" %}

{% block content %}
    <h1>Sales Management</h1>

    <h2>Record Sale</h2>
    <form id="saleForm">
        <label for="product_id">Product ID:</label>
        <input type="number" id="product_id" name="product_id" required>

        <label for="customer_id">Customer ID:</label>
        <input type="number" id="customer_id" name="customer_id" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>

        <label for="amount_paid">Amount Paid:</label>
        <input type="number" id="amount_paid" name="amount_paid" step="0.01" required>

        <button type="submit">Record Sale</button>
    </form>

    <h2>Sales History</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Product ID</th>
                <th>Customer ID</th>
                <th>Quantity</th>
                <th>Total Amount</th>
                <th>Amount Paid</th>
                <th>Balance</th>
                <th>Sale Date</th>
            </tr>
        </thead>
        <tbody>
            {% for sale in sales %}
            <tr>
                <td>{{ sale.id }}</td>
                <td>{{ sale.product_id }}</td>
                <td>{{ sale.customer_id }}</td>
                <td>{{ sale.quantity }}</td>
                <td>{{ sale.total_amount }}</td>
                <td>{{ sale.amount_paid }}</td>
                <td>{{ sale.balance }}</td>
                <td>{{ sale.sale_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
## ./templates/index.html
{% extends "base.html" %}

{% block content %}
    <h1>Welcome to Inventory Management</h1>
    <p>Manage your products, sales, restocks, and invoices efficiently.</p>

    <h2>Quick Links</h2>
    <ul>
        <li><a href="/products">Manage Products</a></li>
        <li><a href="/sales">Record Sales</a></li>
        <li><a href="/restocks">Record Restocks</a></li>
        <li><a href="/invoices">Generate Invoices</a></li>
    </ul>
{% endblock %}
## ./templates/restocks.html
{% extends "base.html" %}

{% block content %}
    <h1>Restock Management</h1>

    <h2>Record Restock</h2>
    <form id="restockForm">
        <label for="product_id">Product ID:</label>
        <input type="number" id="product_id" name="product_id" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>

        <button type="submit">Record Restock</button>
    </form>

    <h2>Restock History</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Product ID</th>
                <th>Quantity</th>
                <th>Restock Date</th>
            </tr>
        </thead>
        <tbody>
            {% for restock in restocks %}
            <tr>
                <td>{{ restock.id }}</td>
                <td>{{ restock.product_id }}</td>
                <td>{{ restock.quantity }}</td>
                <td>{{ restock.restock_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
## ./templates/customers.html
{% extends "base.html" %}

{% block content %}
    <h1>Customer Management</h1>

    <h2>Add Customer</h2>
    <form id="customerForm">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="contact">Contact:</label>
        <input type="text" id="contact" name="contact">

        <button type="submit">Add Customer</button>
    </form>

    <h2>Customer List</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Contact</th>
            </tr>
        </thead>
        <tbody>
            {% for customer in customers %}
            <tr>
                <td>{{ customer.id }}</td>
                <td>{{ customer.name }}</td>
                <td>{{ customer.contact }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
## ./templates/invoices.html
{% extends "base.html" %}

{% block content %}
    <h1>Invoice Management</h1>

    <h2>Generate Invoice</h2>
    <form id="invoiceForm">
        <label for="sale_id">Sale ID:</label>
        <input type="number" id="sale_id" name="sale_id" required>

        <button type="submit">Generate Invoice</button>
    </form>

    <h2>Invoice History</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Sale ID</th>
                <th>Invoice Date</th>
            </tr>
        </thead>
        <tbody>
            {% for invoice in invoices %}
            <tr>
                <td>{{ invoice.id }}</td>
                <td>{{ invoice.sale_id }}</td>
                <td>{{ invoice.invoice_date }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
## ./templates/sales_report.html
<!-- templates/sales_report.html -->
{% extends "base.html" %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h2>Sales Report</h2>
    </div>
</div>

<div class="table-responsive">
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Date</th>
                <th>Total Sales</th>
                <th>Total Revenue</th>
            </tr>
        </thead>
        <tbody>
            {% for report in sales_report %}
            <tr>
                <td>{{ report.sale_date }}</td>
                <td>{{ report.total_sales }}</td>
                <td>${{ "%.2f"|format(report.total_revenue) }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
## ./templates/products.html
{% extends "base.html" %}

{% block content %}
    <h1>Product Management</h1>

    <!-- Add Product Form -->
    <h2>Add Product</h2>
    <form id="productForm" method="POST" action="/products/add">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>

        <label for="description">Description:</label>
        <input type="text" id="description" name="description">

        <label for="price">Price:</label>
        <input type="number" id="price" name="price" step="0.01" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" required>

        <button type="submit">Add Product</button>
    </form>

    <!-- Search Products Form -->
    <h2>Search Products</h2>
    <form id="searchForm" method="GET" action="/products/search" onsubmit="searchProducts(event)">
        <input type="text" id="searchQuery" name="query" placeholder="Search by name or description" required>
        <button type="submit">Search</button>
    </form>

    <!-- Product List -->
    <h2>Product List</h2>
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Description</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.description }}</td>
                <td>{{ product.price }}</td>
                <td>{{ product.quantity }}</td>
                <td>
                    <!-- Edit Button -->
                    <a href="/products/{{ product.id }}/edit" class="btn-edit">Edit</a>
                    <!-- Delete Button -->
                    <button onclick="confirmDelete({{ product.id }})" class="btn-delete">Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function searchProducts(event) {
            event.preventDefault(); // Prevent default form submission
            const query = document.getElementById('searchQuery').value;
            // Implement search logic here (e.g., fetch API call or redirect)
            console.log("Searching for:", query);
        }

        function confirmDelete(productId) {
            if (confirm("Are you sure you want to delete this product?")) {
                // Implement delete logic here (e.g., fetch API call or redirect)
                console.log("Deleting product with ID:", productId);
            }
        }
    </script>
{% endblock %}
## ./templates/edit_product.html
{% extends "base.html" %}

{% block content %}
    <h1>Edit Product</h1>

    <form id="editProductForm">
        <input type="hidden" id="id" name="id" value="{{ product.id }}">

        <label for="name">Name:</label>
        <input type="text" id="name" name="name" value="{{ product.name }}" required>

        <label for="description">Description:</label>
        <input type="text" id="description" name="description" value="{{ product.description }}">

        <label for="price">Price:</label>
        <input type="number" id="price" name="price" value="{{ product.price }}" step="0.01" required>

        <label for="quantity">Quantity:</label>
        <input type="number" id="quantity" name="quantity" value="{{ product.quantity }}" required>

        <button type="submit">Update Product</button>
    </form>
{% endblock %}
## ./templates/base.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory Management</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/style.css') }}">
</head>
<body>
    <div class="navbar">
        <a href="/">Home</a>
        <a href="/products">Products</a>
        <a href="/sales">Sales</a>
        <a href="/restocks">Restocks</a>
        <a href="/invoices">Invoices</a>
    </div>

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <script src="{{ url_for('static', path='js/main.js') }}"></script>
</body>
</html>

